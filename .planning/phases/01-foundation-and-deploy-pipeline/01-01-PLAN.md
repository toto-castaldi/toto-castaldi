---
phase: 01-foundation-and-deploy-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - config/_default/hugo.toml
  - config/_default/languages.toml
  - content/_index.it.md
  - content/_index.en.md
  - layouts/_default/baseof.html
  - layouts/index.html
  - layouts/partials/head.html
  - assets/css/main.css
  - static/CNAME
  - static/404.html
  - i18n/it.toml
  - i18n/en.toml
  - .github/workflows/hugo.yaml
autonomous: true
requirements:
  - INFR-01
  - INFR-03
  - INFR-04
  - INFR-05

must_haves:
  truths:
    - "Hugo builds successfully with `hugo --minify` producing a public/ directory"
    - "public/ contains /it/index.html and /en/index.html with correct language content"
    - "public/ contains root index.html with meta-refresh redirect to /it/"
    - "public/CNAME exists with content toto-castaldi.com"
    - "public/404.html exists with bilingual content"
    - "GitHub Actions workflow file exists and is valid YAML"
  artifacts:
    - path: "config/_default/hugo.toml"
      provides: "Site-wide Hugo config with baseURL, defaultContentLanguage, defaultContentLanguageInSubdir"
      contains: "defaultContentLanguageInSubdir = true"
    - path: "config/_default/languages.toml"
      provides: "Italian and English language definitions"
      contains: "[it]"
    - path: "content/_index.it.md"
      provides: "Italian placeholder homepage"
      contains: "Antonio Toto Castaldi"
    - path: "content/_index.en.md"
      provides: "English placeholder homepage"
      contains: "Antonio Toto Castaldi"
    - path: "layouts/_default/baseof.html"
      provides: "Base HTML template with lang attribute"
      contains: ".Site.Language.Lang"
    - path: "layouts/index.html"
      provides: "Home page template rendering title and content"
      contains: ".Content"
    - path: "layouts/partials/head.html"
      provides: "Head partial with meta tags and Hugo Pipes CSS"
      contains: "resources.Fingerprint"
    - path: "assets/css/main.css"
      provides: "Minimal stylesheet processed via Hugo Pipes"
      min_lines: 5
    - path: "static/CNAME"
      provides: "Custom domain persistence across deploys"
      contains: "toto-castaldi.com"
    - path: "static/404.html"
      provides: "Bilingual root-level 404 page (Hugo issue #5161 workaround)"
      contains: "404"
    - path: ".github/workflows/hugo.yaml"
      provides: "CI/CD pipeline for GitHub Pages deployment"
      contains: "hugo --gc --minify"
  key_links:
    - from: "layouts/partials/head.html"
      to: "assets/css/main.css"
      via: "Hugo Pipes resource pipeline"
      pattern: "resources\\.Get.*css/main\\.css"
    - from: "layouts/_default/baseof.html"
      to: "layouts/partials/head.html"
      via: "Hugo partial include"
      pattern: "partial.*head\\.html"
    - from: "config/_default/hugo.toml"
      to: "config/_default/languages.toml"
      via: "Hugo split config auto-merge"
      pattern: "defaultContentLanguage"
---

<objective>
Create the complete Hugo project scaffold with bilingual configuration, placeholder content, GitHub Actions workflow, and static files for custom domain support.

Purpose: Establish the entire codebase for Phase 1 so that a single push to main triggers a successful build and deployment of a bilingual Hugo site to GitHub Pages.

Output: All Hugo project files, GitHub Actions workflow, CNAME, and bilingual 404 page.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-deploy-pipeline/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Hugo project scaffold with multilingual configuration and templates</name>
  <files>
    config/_default/hugo.toml
    config/_default/languages.toml
    content/_index.it.md
    content/_index.en.md
    layouts/_default/baseof.html
    layouts/index.html
    layouts/partials/head.html
    assets/css/main.css
    i18n/it.toml
    i18n/en.toml
  </files>
  <action>
    Create the Hugo project structure from scratch. Do NOT run `hugo new site` -- create files manually for full control.

    **config/_default/hugo.toml:**
    ```toml
    baseURL = 'https://toto-castaldi.com/'
    title = 'Antonio Toto Castaldi'
    defaultContentLanguage = 'it'
    defaultContentLanguageInSubdir = true
    ```
    This is the Day 0 decision: Italian as default language, both languages in subdirectories (/it/ and /en/). Root `/` gets Hugo's auto-generated meta-refresh redirect to `/it/`.

    **config/_default/languages.toml:**
    ```toml
    [it]
      languageCode = 'it'
      languageName = 'Italiano'
      title = 'Antonio Toto Castaldi'
      weight = 1

    [en]
      languageCode = 'en'
      languageName = 'English'
      title = 'Antonio Toto Castaldi'
      weight = 2
    ```

    **content/_index.it.md:**
    Frontmatter with `title: "Antonio Toto Castaldi"`. Body text: a brief Italian sentence indicating the site is under construction (e.g., "Sito in costruzione. I progetti saranno disponibili a breve.").

    **content/_index.en.md:**
    Frontmatter with `title: "Antonio Toto Castaldi"`. Body text: a brief English sentence indicating the site is under construction (e.g., "Site under construction. Projects coming soon.").

    **layouts/_default/baseof.html:**
    Standard Hugo base template. `<html lang="{{ .Site.Language.Lang }}">`. Include `{{ partial "head.html" . }}` in head. Include `{{ block "main" . }}{{ end }}` in body inside a `<main>` element.

    **layouts/index.html:**
    Home page template. `{{ define "main" }}` block with `<section>` containing `<h1>{{ .Title }}</h1>` and `{{ .Content }}`.

    **layouts/partials/head.html:**
    Include: `<meta charset="utf-8">`, `<meta name="viewport" content="width=device-width, initial-scale=1">`, `<title>{{ .Title }}</title>`. Process CSS via Hugo Pipes: `{{ $css := resources.Get "css/main.css" | resources.Minify | resources.Fingerprint }}` then `<link rel="stylesheet" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}">`.

    **assets/css/main.css:**
    Minimal stylesheet: system font stack (`font-family: system-ui, -apple-system, sans-serif`), centered text, clean typography. Just enough to confirm the Hugo Pipes pipeline works. Body max-width, auto margins, padding.

    **i18n/it.toml and i18n/en.toml:**
    Minimal i18n string files. Include at least a `[siteTitle]` key with value "Antonio Toto Castaldi" in each. These validate the i18n pipeline; Phase 2 will add real UI strings.
  </action>
  <verify>
    Run `hugo --minify` from the project root. Verify:
    1. Build succeeds with exit code 0
    2. `public/it/index.html` exists and contains "Antonio Toto Castaldi" and Italian text
    3. `public/en/index.html` exists and contains "Antonio Toto Castaldi" and English text
    4. `public/index.html` exists and contains `meta http-equiv="refresh"` pointing to `/it/`
    5. CSS fingerprinted file exists in `public/` under a hashed filename
  </verify>
  <done>Hugo builds successfully, producing distinct /it/ and /en/ pages with correct language content, a root redirect to /it/, and fingerprinted CSS assets.</done>
</task>

<task type="auto">
  <name>Task 2: Create GitHub Actions workflow, CNAME, and bilingual 404 page</name>
  <files>
    .github/workflows/hugo.yaml
    static/CNAME
    static/404.html
  </files>
  <action>
    **static/CNAME:**
    Single line: `toto-castaldi.com` (no protocol, no trailing newline). This file is copied to `public/` root on every Hugo build, ensuring GitHub Pages custom domain persists across artifact-based deploys.

    **static/404.html:**
    Hand-crafted bilingual 404 page. This is needed because Hugo issue #5161 means no root-level 404.html is generated when `defaultContentLanguageInSubdir = true`. Include:
    - DOCTYPE, charset, viewport meta
    - Inline CSS: system font stack, centered text, clean minimal styling
    - "404" heading
    - Italian section: "Pagina non trovata." with link to `/it/`
    - Horizontal rule separator
    - English section: "Page not found." with link to `/en/`

    See the exact HTML in the research file code examples section.

    **.github/workflows/hugo.yaml:**
    GitHub Actions workflow for building and deploying to GitHub Pages. Based on Hugo official docs but modified for this project:

    ```yaml
    name: Build and deploy

    on:
      push:
        branches:
          - main
      workflow_dispatch:

    permissions:
      contents: read
      pages: write
      id-token: write

    concurrency:
      group: pages
      cancel-in-progress: false

    defaults:
      run:
        shell: bash

    jobs:
      build:
        runs-on: ubuntu-latest
        env:
          DART_SASS_VERSION: 1.97.3
          HUGO_VERSION: 0.155.3
        steps:
          - name: Checkout
            uses: actions/checkout@v5
            with:
              fetch-depth: 0
          - name: Setup Pages
            id: pages
            uses: actions/configure-pages@v5
          - name: Install Dart Sass
            run: |
              curl -sLJO "https://github.com/sass/dart-sass/releases/download/${DART_SASS_VERSION}/dart-sass-${DART_SASS_VERSION}-linux-x64.tar.gz"
              tar -C "$HOME/.local" -xf "dart-sass-${DART_SASS_VERSION}-linux-x64.tar.gz"
              rm "dart-sass-${DART_SASS_VERSION}-linux-x64.tar.gz"
              echo "$HOME/.local/dart-sass" >> "$GITHUB_PATH"
          - name: Install Hugo
            run: |
              curl -sLJO "https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_linux-amd64.tar.gz"
              mkdir -p "$HOME/.local/hugo"
              tar -C "$HOME/.local/hugo" -xf "hugo_extended_${HUGO_VERSION}_linux-amd64.tar.gz"
              rm "hugo_extended_${HUGO_VERSION}_linux-amd64.tar.gz"
              echo "$HOME/.local/hugo" >> "$GITHUB_PATH"
          - name: Build
            run: hugo --gc --minify
          - name: Upload artifact
            uses: actions/upload-pages-artifact@v3
            with:
              path: ./public
      deploy:
        environment:
          name: github-pages
          url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-latest
        needs: build
        steps:
          - name: Deploy to GitHub Pages
            id: deployment
            uses: actions/deploy-pages@v4
    ```

    CRITICAL: Do NOT include `--baseURL` flag in the build step. The baseURL is hardcoded in hugo.toml. Adding `--baseURL` from `configure-pages` output would inject the repo name for project sites, breaking all internal links when a custom domain is configured.
  </action>
  <verify>
    1. Verify `static/CNAME` contains exactly `toto-castaldi.com`
    2. Run `hugo --minify` and confirm `public/CNAME` exists with correct content
    3. Run `hugo --minify` and confirm `public/404.html` exists with both Italian and English text
    4. Validate `.github/workflows/hugo.yaml` is valid YAML (use `python3 -c "import yaml; yaml.safe_load(open('.github/workflows/hugo.yaml'))"`)
    5. Confirm the workflow does NOT contain `--baseURL` flag
  </verify>
  <done>GitHub Actions workflow is valid YAML with no --baseURL flag, CNAME appears in build output, and bilingual 404.html is present at root level.</done>
</task>

</tasks>

<verification>
Run from project root:
1. `hugo --minify` succeeds (exit 0)
2. `ls public/it/index.html public/en/index.html public/index.html public/CNAME public/404.html` -- all exist
3. `grep -l "Antonio Toto Castaldi" public/it/index.html public/en/index.html` -- name present in both
4. `grep "refresh" public/index.html` -- root redirect exists
5. `grep "toto-castaldi.com" public/CNAME` -- CNAME correct
6. `grep "Pagina non trovata" public/404.html && grep "Page not found" public/404.html` -- bilingual 404
7. `python3 -c "import yaml; yaml.safe_load(open('.github/workflows/hugo.yaml'))"` -- valid workflow
8. `hugo server -D` starts without errors (manual check)
</verification>

<success_criteria>
- Hugo builds a complete bilingual site with /it/ and /en/ paths
- Root URL contains meta-refresh redirect to /it/
- CNAME persists in build output
- 404 page covers both languages at root level
- GitHub Actions workflow is ready for deployment (no --baseURL pitfall)
- All files follow research recommendations exactly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-deploy-pipeline/01-01-SUMMARY.md`
</output>
