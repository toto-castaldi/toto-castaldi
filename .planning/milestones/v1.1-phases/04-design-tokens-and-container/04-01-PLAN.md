---
phase: 04-design-tokens-and-container
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - assets/css/main.css
  - layouts/_default/baseof.html
autonomous: true
requirements:
  - LAYOUT-04
  - THEME-01
  - THEME-02
  - THEME-03
  - THEME-04
  - THEME-05
  - STYLE-05

must_haves:
  truths:
    - "Light mode text contrast passes WCAG AA (4.5:1+) on both page and card backgrounds"
    - "Dark mode text contrast passes WCAG AA (4.5:1+) on both page and card backgrounds"
    - "Border contrast >= 3:1 against adjacent surfaces in both themes"
    - "Cards are visually distinct from page background in both light and dark mode"
    - "Dark/light toggle works in all 4 states (OS-light unchecked, OS-light checked, OS-dark unchecked, OS-dark checked)"
    - "Page container is 1080px max-width, centered, with adequate mobile padding"
    - "Light mode page background is off-white (#f9fafb), cards are white (#ffffff)"
  artifacts:
    - path: "assets/css/main.css"
      provides: "Updated color tokens in all 4 toggle states + container layout"
      contains: "--color-bg: #f9fafb"
    - path: "layouts/_default/baseof.html"
      provides: "Container wrapper inside page-wrapper"
      contains: "container"
  key_links:
    - from: "layouts/_default/baseof.html"
      to: "assets/css/main.css"
      via: ".container class usage"
      pattern: "class=\"container\""
    - from: "assets/css/main.css"
      to: "assets/css/main.css"
      via: "4 toggle state blocks all use same 7 token names"
      pattern: "--color-card-bg"
---

<objective>
Fix WCAG AA contrast failures in both themes and widen the page container to support a 3-column grid.

Purpose: Both themes currently fail WCAG AA border contrast (light 1.24:1, dark 1.72:1 -- need 3:1). Cards are indistinguishable from page background in light mode (both #ffffff). The 680px container is too narrow for the upcoming bento grid. This plan fixes all contrast issues and prepares the layout.

Output: Updated `assets/css/main.css` with WCAG-verified token values in all 4 toggle states, restructured `baseof.html` with container element, and widened max-width to 1080px.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-design-tokens-and-container/04-RESEARCH.md
@assets/css/main.css
@layouts/_default/baseof.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update color tokens to WCAG-verified values in all 4 toggle states</name>
  <files>assets/css/main.css</files>
  <action>
Replace color token values in all 4 CSS blocks that define theme colors. Each block must set all 7 tokens. The 4 blocks are:

1. **`:root` (light mode default)** -- Update:
   - `--color-bg: #f9fafb` (was #ffffff -- off-white page bg per STYLE-05)
   - `--color-border: #8891a0` (was #e5e7eb -- fixes 1.24:1 -> 3.18:1 on white)
   - `--color-card-bg: #ffffff` (was #ffffff -- unchanged but now distinct from page bg)
   - Keep `--color-text`, `--color-text-muted`, `--color-link`, `--color-link-hover` unchanged
   - Update `--max-width: 1080px` (was 680px -- per LAYOUT-04)

2. **`@media (prefers-color-scheme: dark) :root` AND `.page-wrapper`** -- Update both selectors in this block:
   - `--color-bg: #0f172a` (was #111827 -- slate-900)
   - `--color-text: #f1f5f9` (was #f3f4f6 -- slate-100)
   - `--color-text-muted: #94a3b8` (was #9ca3af -- slate-400)
   - `--color-border: #64748b` (was #374151 -- fixes 1.72:1 -> 3.07:1)
   - `--color-link: #60a5fa` (unchanged)
   - `--color-link-hover: #93bbfd` (unchanged)
   - `--color-card-bg: #1e293b` (was #1f2937 -- slate-800)

3. **`#dark-toggle:checked + .page-wrapper` (light OS -> dark override)** -- Update with same dark values as block 2.

4. **`@media (prefers-color-scheme: dark) #dark-toggle:checked + .page-wrapper` (dark OS -> light override)** -- Update with same light values as block 1:
   - `--color-bg: #f9fafb` (was #ffffff)
   - `--color-border: #8891a0` (was #e5e7eb)
   - `--color-card-bg: #ffffff` (was #ffffff)
   - Keep other 4 tokens unchanged

Also add a belt-and-suspenders body background fallback: `body { background: var(--color-bg); }` -- this covers edge cases like iOS overscroll bounce. The toggle cannot control body directly, but .page-wrapper covers 100vh so the body bg only matters at viewport edges.
  </action>
  <verify>
Run `hugo server -D` and verify:
1. Light mode: page background is subtly off-white, cards are white with visible borders
2. Dark mode: page is dark slate-900, cards are slightly lighter slate-800 with visible borders
3. Toggle the dark mode checkbox -- both transitions work correctly
4. Grep main.css for the 4 blocks and confirm all 7 tokens present in each: `grep -c 'color-card-bg' assets/css/main.css` should return 4
  </verify>
  <done>All 4 CSS toggle blocks contain WCAG-verified token values. Light border contrast >= 3:1, dark border contrast >= 3:1. Light page bg is #f9fafb (off-white). --max-width is 1080px.</done>
</task>

<task type="auto">
  <name>Task 2: Restructure page-wrapper and add container element</name>
  <files>assets/css/main.css, layouts/_default/baseof.html</files>
  <action>
**HTML change in `layouts/_default/baseof.html`:**
Add a `<div class="container">` inside `.page-wrapper`, wrapping `<header>` and `<main>`:

```html
<div class="page-wrapper">
  <div class="container">
    <header class="site-header">...</header>
    <main>{{ block "main" . }}{{ end }}</main>
  </div>
</div>
```

The `<input>` and `<div class="page-wrapper">` remain siblings (checkbox hack preserved).

**CSS change in `assets/css/main.css`:**
Update `.page-wrapper` rule -- remove `max-width` and `margin: 0 auto` (no longer constraining width). Keep `color`, `background`, `min-height: 100vh`. The wrapper is now full-width for seamless toggle background coverage.

Add new `.container` rule:
```css
.container {
  max-width: var(--max-width);
  margin: 0 auto;
  padding: var(--space-xl) var(--space-md);
}
```

Move `padding` from `.page-wrapper` to `.container`. The wrapper only handles color/background; the container handles layout constraints.

Do NOT change the toggle icon selectors -- they use `#dark-toggle:checked + .page-wrapper .toggle-icon--*` which still works because `.container` is a descendant of `.page-wrapper`.
  </action>
  <verify>
Run `hugo server -D` and verify:
1. Content is centered at 1080px max-width on wide screens
2. On narrow screens, content has adequate horizontal padding (24px / 1.5rem)
3. Toggle still works -- background change covers the entire viewport width (no white strips at edges)
4. Build succeeds: `hugo --minify` exits 0
  </verify>
  <done>`.page-wrapper` is full-width with background coverage. `.container` constrains content to 1080px centered. Toggle background change covers entire viewport. All existing content renders correctly within the new container.</done>
</task>

</tasks>

<verification>
1. `hugo --minify` builds without errors
2. Light mode: off-white page (#f9fafb), white cards (#ffffff), visible borders (#8891a0)
3. Dark mode: slate-900 page (#0f172a), slate-800 cards (#1e293b), visible borders (#64748b)
4. Toggle works in all 4 states: OS-light unchecked (light), OS-light checked (dark), OS-dark unchecked (dark), OS-dark checked (light)
5. Container max-width is 1080px with centered layout
6. Full-viewport background coverage (no color mismatch at edges during toggle)
7. All text contrast >= 4.5:1, all border contrast >= 3:1 (per research verification table)
</verification>

<success_criteria>
- Both themes pass WCAG AA contrast for text (4.5:1) and UI components (3:1)
- Cards visually distinct from page background in both themes
- Dark/light toggle works in all 4 states without viewport edge color flash
- Page container is 1080px, centered, with mobile-safe padding
- Hugo builds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/04-design-tokens-and-container/04-01-SUMMARY.md`
</output>
