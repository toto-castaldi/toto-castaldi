---
phase: 03-seo-and-production-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - config/_default/languages.toml
  - layouts/partials/seo.html
  - layouts/partials/head.html
autonomous: true
requirements:
  - SEO-01
  - SEO-02
  - SEO-03

must_haves:
  truths:
    - "Italian page includes hreflang tags pointing to both /it/ and /en/ with absolute URLs, plus x-default"
    - "English page includes hreflang tags pointing to both /it/ and /en/ with absolute URLs, plus x-default"
    - "Each language page has a self-referencing canonical URL using absolute URL"
    - "Italian page has og:locale content it_IT and English page has og:locale content en_US"
    - "Both pages include og:title, og:description, og:url, og:site_name meta tags"
  artifacts:
    - path: "layouts/partials/seo.html"
      provides: "hreflang links, canonical URL, Open Graph include"
      contains: "AllTranslations"
    - path: "layouts/partials/head.html"
      provides: "SEO partial inclusion in HTML head"
      contains: "seo.html"
    - path: "config/_default/languages.toml"
      provides: "Territory-qualified language codes for og:locale"
      contains: "it-IT"
  key_links:
    - from: "layouts/partials/head.html"
      to: "layouts/partials/seo.html"
      via: "Hugo partial call"
      pattern: 'partial "seo.html"'
    - from: "layouts/partials/seo.html"
      to: "Hugo embedded opengraph.html"
      via: "Hugo partial call"
      pattern: 'partial "opengraph.html"'
    - from: "layouts/partials/seo.html"
      to: "config/_default/languages.toml"
      via: ".Language.LanguageCode for hreflang values"
      pattern: ".Language.LanguageCode"
---

<objective>
Add hreflang tags, Open Graph meta tags, and canonical URLs to both language versions of the site so search engines discover correct multilingual signals and social platforms render rich previews when URLs are shared.

Purpose: Complete the final phase of the site by making it discoverable and shareable.
Output: Three files -- new `seo.html` partial, updated `head.html`, updated `languages.toml`.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-seo-and-production-polish/03-RESEARCH.md
@layouts/partials/head.html
@config/_default/languages.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SEO partial with hreflang, canonical, and Open Graph tags</name>
  <files>config/_default/languages.toml, layouts/partials/seo.html, layouts/partials/head.html</files>
  <action>
    1. Update `config/_default/languages.toml`: Change `languageCode = 'it'` to `languageCode = 'it-IT'` and `languageCode = 'en'` to `languageCode = 'en-US'`. Keep all other fields unchanged. This is required for Hugo's embedded opengraph.html to produce valid `og:locale` values (it_IT, en_US) -- the OG protocol requires language_TERRITORY format.

    2. Create `layouts/partials/seo.html` with this exact content:
       - Self-referencing canonical URL: `<link rel="canonical" href="{{ .Permalink }}">`
       - hreflang reciprocal links using `{{ range .AllTranslations }}` (NOT `.Translations` -- `.AllTranslations` includes self-reference which Google requires for reciprocal linking): `<link rel="alternate" hreflang="{{ .Language.LanguageCode }}" href="{{ .Permalink }}">`
       - x-default pointing to site root: `<link rel="alternate" hreflang="x-default" href="{{ site.BaseURL }}">`
       - Open Graph include: `{{ partial "opengraph.html" . }}` (NOT the old `{{ template "_internal/opengraph.html" . }}` syntax which was removed)
       - Use `.Permalink` everywhere (absolute URLs), never `.RelPermalink`

    3. Update `layouts/partials/head.html`: Add `{{ partial "seo.html" . }}` as the last line, after the stylesheet link tag.
  </action>
  <verify>
    Run `hugo --minify` and inspect the built HTML output:
    - `grep -c 'hreflang' public/it/index.html` should return 3 (it-IT, en-US, x-default)
    - `grep -c 'hreflang' public/en/index.html` should return 3 (it-IT, en-US, x-default)
    - `grep 'rel="canonical"' public/it/index.html` should show `https://toto-castaldi.com/it/`
    - `grep 'rel="canonical"' public/en/index.html` should show `https://toto-castaldi.com/en/`
    - `grep 'og:locale' public/it/index.html` should show `it_IT`
    - `grep 'og:locale' public/en/index.html` should show `en_US`
    - `grep 'og:url' public/it/index.html` should show `https://toto-castaldi.com/it/`
    - `grep 'og:title' public/it/index.html` should show the Italian title
    - Verify HTML `lang` attribute is still `it` / `en` (not `it-IT` / `en-US`) by checking `<html lang=` in both outputs
  </verify>
  <done>
    Both /it/ and /en/ pages contain: (a) 3 hreflang link tags (it-IT, en-US, x-default) all with absolute URLs, (b) self-referencing canonical URL with absolute URL, (c) og:locale with correct territory format (it_IT / en_US), (d) og:title, og:description, og:url, og:site_name meta tags. HTML lang attribute remains unchanged at it/en.
  </done>
</task>

</tasks>

<verification>
Build the site with `hugo --minify` and check both language pages for all required SEO tags:
1. hreflang reciprocal links: Both pages list both languages + x-default, all absolute URLs
2. Canonical URLs: Each page's canonical points to itself with absolute URL
3. Open Graph: og:locale uses territory format, og:url matches page URL, og:title and og:description present
4. No regression: HTML lang attribute unchanged, CSS/layout unaffected
</verification>

<success_criteria>
- `hugo --minify` builds without errors
- Italian page /it/ contains hreflang it-IT, en-US, x-default with absolute URLs
- English page /en/ contains hreflang it-IT, en-US, x-default with absolute URLs
- Each page has self-referencing canonical with absolute URL
- og:locale is it_IT on Italian page, en_US on English page
- og:title, og:description, og:url present on both pages
- HTML lang attribute still reads "it" and "en" (not "it-IT"/"en-US")
</success_criteria>

<output>
After completion, create `.planning/phases/03-seo-and-production-polish/03-01-SUMMARY.md`
</output>
